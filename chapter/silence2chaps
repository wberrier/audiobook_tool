#!/usr/bin/env python3

import re
import sys

# TODO: accept "format" as an argument for chapter format

# if args passed in, use first argument, otherwise use 2
bottom = 2.0
if len(sys.argv) > 1:
    bottom = float(sys.argv[1])

# if arg passed in, use that, otherwise "inf"
top = float('inf')
if len(sys.argv) > 2:
    top = float(sys.argv[2])

count = 0

for line in sys.stdin:
    matches = re.search(r"^(\d+)\t(\d+)\t(\d+)\.(\d+)$", line.rstrip())

    if matches:
        (gap, chap, s, ms) = (int(matches.group(1)), int(matches.group(2)), int(matches.group(3)), int(matches.group(4)))

        gap_s = float(gap) / 1000

        if bottom <= gap_s and gap_s <= top:
            count = count + 1

            # m4b format
            print("%02d:%02d:%02d.%03d Chapter %s (silence %s)" % (s//3600, (s//60) % 60, s % 60, ms//10, chap, gap))

            # ogg/opus/mka format
            # print("CHAPTER%03d=%02d:%02d:%02d.%03d" % (count, s//3600, (s//60) % 60, s % 60, ms//10))
            # print("CHAPTER%03dNAME=Chapter %s (silence %s)" % (count, chap, gap))
